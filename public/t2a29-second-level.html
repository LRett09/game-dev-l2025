<body id="myBody" style="background-repeat:repeat; background-size:25%;" background="Boss Background.gif">

<img id="myImg01" style="position:absolute; width:100px; height:80px; top:800px; left:50px" src="img01.gif">
<img id="myImg02" style="position:absolute; width:280px; height:200px; top:400px; left:950px" src="BossOne.gif">
<img id="attackBox" style="position:absolute; width:80px; height:120px; top:400px; left:950px" src="BaseballBat.png">

<img id="myAtk01" style="position:absolute; width:80px; height:80px; top:400px; left:950px" src="BossAttack01.png">
<img id="myAtk02" style="position:absolute; width:80px; height:80px; top:400px; left:950px" src="BossAttack02.gif">
<img id="myAtk03" style="position:absolute; width:80px; height:80px; top:400px; left:950px" src="BossAttack03.gif">
<img id="myAtk04" style="position:absolute; width:200px; height:200px; top:400px; left:950px" src="BossAttack04.gif">

<audio id="bossMusic" src="CRITICAL OVERLOAD.mp3" loop></audio>

<script>

//=====GLOBAL VARIABLES=====
let moveAmount = 10
let x = 50
let y = 800
let velX = 0
let velY = 0

const ACCEL = 1.2     
const MAX_SPEED = 5 
const FRICTION = 0.85 
let keys = {}

document.addEventListener("keydown", e => keys[e.key] = true)
document.addEventListener("keyup", e => keys[e.key] = false)



let isAttacking = false
let attackDuration = 200
let myDirection = "right"

let musicStarted = false
let bossMusic = document.getElementById("bossMusic")

let playerHP = 3
let iFrameTime = 0
let lastHitTime = 0
const IFRAME_DURATION = 1000

let myImg01
let myImg02
let attackBox

let bossFight = true
let myEnemyHp = 0
let currentAttack = 0
let atkActive = true
let atkSpawned = false

let myAtk01
let myAtk02
let atk02VelX = 4
let atk02VelY = 3
let myAtk03
let atk03CanHit
let atkStartTime = 0
let myAtk04

//=====COLLISION=====
function myHitOther(my1, my2) {
  let a = document.getElementById(my1)
  let b = document.getElementById(my2)

  let left1 = parseInt(a.style.left)
  let right1 = left1 + parseInt(a.style.width)
  let top1 = parseInt(a.style.top)
  let bottom1 = top1 + parseInt(a.style.height)

  let left2 = parseInt(b.style.left)
  let right2 = left2 + parseInt(b.style.width)
  let top2 = parseInt(b.style.top)
  let bottom2 = top2 + parseInt(b.style.height)

  return right1 >= left2 && left1 <= right2 &&
         bottom1 >= top2 && top1 <= bottom2
}

window.onload = function () {

  myImg01 = document.getElementById("myImg01")
  myImg02 = document.getElementById("myImg02")

  myAtk01 = document.getElementById("myAtk01")
  myAtk02 = document.getElementById("myAtk02")
  myAtk03 = document.getElementById("myAtk03")
  myAtk04 = document.getElementById("myAtk04")

  myAtk01.style.display = "none"
  myAtk02.style.display = "none"
  myAtk03.style.display = "none"
  myAtk04.style.display = "none"

  attackBox = document.getElementById("attackBox")
  attackBox.style.display = "none"

  setInterval(BossAttack, 20)

  //=====PLAYER MOVEMENT=====
document.addEventListener("keydown", function (e) {

  keys[e.key] = true

  if (e.key === " ") attack()

  if (!musicStarted) {
    bossMusic.volume = 0.6
    bossMusic.play()
    musicStarted = true
  }
})
  
document.addEventListener("keyup", function (e) {
  keys[e.key] = false
})
  
setInterval(updatePlayer, 20)

function updatePlayer() {
  let oldX = x
  let oldY = y

  if (keys["w"]) velY -= ACCEL
  if (keys["s"]) velY += ACCEL
  if (keys["a"]) { velX -= ACCEL; myDirection = "left" }
  if (keys["d"]) { velX += ACCEL; myDirection = "right" }

  velX = Math.max(-MAX_SPEED, Math.min(MAX_SPEED, velX))
  velY = Math.max(-MAX_SPEED, Math.min(MAX_SPEED, velY))

  x += velX
  y += velY

  if (!keys["a"] && !keys["d"]) velX *= FRICTION
  if (!keys["w"] && !keys["s"]) velY *= FRICTION

  myImg01.style.left = x + "px"
  myImg01.style.top = y + "px"

  if (myHitOther('myImg01', 'myImg02')) {
    x = oldX
    y = oldY
    velX = 0
    velY = 0
  }
}

}

//=====BOSS ATTACKS=====
function BossAttack() {
  if (!bossFight) return

  //=====SPAWN=====
  if (!atkSpawned) {
    currentAttack = Math.floor(Math.random() * 4) + 1
    atkSpawned = true
    atkStartTime = Date.now()

    if (currentAttack === 1) {
      myAtk01.style.display = "block"
      myAtk01.style.left = "950px"
      myAtk01.style.top = "400px"
    }

  if (currentAttack === 2) {
  myAtk02.style.display = "block"
  myAtk02.style.left = "950px"
  myAtk02.style.top = "400px"

  atk02VelX = Math.random() > 0.5 ? 4 : -4
  atk02VelY = Math.random() > 0.5 ? 3 : -3
}


    if (currentAttack === 3) {
      myAtk03.style.display = "block"
      myAtk03.style.left = (x + 10) + "px"
      myAtk03.style.top = (y + 10) + "px"
      atk03CanHit = false
    }

    if (currentAttack === 4) {
      myAtk04.style.display = "block"
      myAtk04.style.top = "400px"
      myAtk04.style.left = "500px"
  }
  }

  //=====HOMING=====
  if (currentAttack === 1 && atkSpawned) {
    let bx = parseInt(myAtk01.style.left)
    let by = parseInt(myAtk01.style.top)

    let dx = x - bx
    let dy = y - by
    let dist = Math.sqrt(dx * dx + dy * dy)

    let speed = 4

    if (dist > 0) {
      bx += (dx / dist) * speed
      by += (dy / dist) * speed
    }

    if (myHitOther('myAtk01', 'myImg01')) playerHit()

    myAtk01.style.left = bx + "px"
    myAtk01.style.top = by + "px"

    if (dist < 30 || Date.now() - atkStartTime > 5000) resetAttack()
  }

  //=====SHAKRAM=====
 if (currentAttack === 2 && atkSpawned) {
  let bx = parseInt(myAtk02.style.left)
  let by = parseInt(myAtk02.style.top)

  bx += atk02VelX
  by += atk02VelY

  if (bx <= 0 || bx >= window.innerWidth - 80) {
    atk02VelX *= -1
  }

  if (by <= 0 || by >= window.innerHeight - 80) {
    atk02VelY *= -1
  }

  myAtk02.style.left = bx + "px"
  myAtk02.style.top = by + "px"

  if (myHitOther('myAtk02', 'myImg01')) {
    playerHit()
  }

  if (Date.now() - atkStartTime > 10000) {
    resetAttack()
  }
}
  //=====EXPLODE=====
  if (currentAttack === 3 && atkSpawned) {
    if (Date.now() - atkStartTime > 3000) atk03CanHit = true
    if (atk03CanHit && myHitOther('myAtk03', 'myImg01')) playerHit()
    if (Date.now() - atkStartTime > 4000) resetAttack()
  }

  //=====SWORD=====
    if (currentAttack === 4 && atkSpawned) {
      if (myHitOther('myAtk04', 'myImg01')) {
        playerHit()
      }
   if (Date.now() - atkStartTime > 1000) {
    resetAttack()
}
}
}

//======RESET ATTACKS=====
function resetAttack() {
  myAtk01.style.display = "none"
  myAtk02.style.display = "none"
  myAtk03.style.display = "none"
  myAtk04.style.display = "none"
  currentAttack = null
  atkSpawned = false
  isAttacking = false
}

//=====PLAYER ATTACK=====
function attack() {
  if (isAttacking) return
  isAttacking = true

  attackBox.style.display = "block"

  if (myDirection === "right") {
    attackBox.style.left = (x + 75) + "px"
    attackBox.style.top = (y - 20) + "px"
  } else {
    attackBox.style.left = (x - 60) + "px"
    attackBox.style.top = (y - 20) + "px"
  }

  if (myHitOther('attackBox', 'myImg02')) enemyHit()

  setTimeout(() => {
    attackBox.style.display = "none"
    isAttacking = false
  }, attackDuration)
}

//=====HIT ENEMY=====
function enemyHit() {
  if (myEnemyHp >= 13) {
  myImg01.style.display = "none"
  myImg02.style.display = "none"
    bossFight = false
    atkSpawned = false
    document.getElementById("myBody").style.backgroundImage = "url('Title Screen.gif')"
  } else {
    myEnemyHp++
  }
}

//=====PLAYER HIT=====
function playerHit() {
  const now = Date.now()
  if (now - lastHitTime < IFRAME_DURATION) return

  lastHitTime = now
  playerHP--
  resetAttack()

  myImg01.style.opacity = "0.5"
  setTimeout(() => myImg01.style.opacity = "1", IFRAME_DURATION)

if (playerHP <= 0) {
  bossFight = false
  myImg01.style.display = "none"
  myImg02.style.display = "none"
  myAtk01.style.display = "none"
  myAtk02.style.display = "none"
  myAtk03.style.display = "none"
  myAtk04.style.display = "none"
  attackBox.style.display = "none"
  document.getElementById("myBody").style.backgroundImage =
    "url('Death Screen.gif')" 
  document.getElementById("myBody").size = "85%"

  setTimeout(() => {
    reset()
    document.getElementById("myBody").style.backgroundImage =
      "url('Boss Background.gif')"
      document.getElementById("myBody").size = "25%"
  }, 3000)
}

//=====RESET=====
function reset() {
  isAttacking = false
  myDirection = "right"
  playerHP = 3
  lastHitTime = 0

  bossFight = true
  myEnemyHp = 0
  currentAttack = 0
  atkSpawned = false

  myAtk01.style.display = "none"
  myAtk03.style.display = "none"

  x = 50
  y = 800
  myImg01.style.left = x + "px"
  myImg01.style.top = y + "px"
  myImg01.style.display = "block"
}
</script>

