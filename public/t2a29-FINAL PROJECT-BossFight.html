<body id="myBody" style="background-size:120%;" background="Training Room.png">

<img id="myImg01" style="position:absolute; width:100px; height:80px; top:400px; left:50px;" src="img01.gif">
<img id="myImg02" style="position:absolute; width:200px; height:180px; top:400px; left:950px;" src="Training dummy.png">
<img id="rift" style="position:absolute; width:100px; height:100px; top:400px; left:1600px;" src="Rift.gif">
<img id="attackBox" style="position:absolute; width:80px; height:120px; top:400px; left:1600px;" src="BaseballBat.png">

<script>

// ===== GLOBAL VARIABLES =====
let enemyX = 950
let enemyY = 0
let enemySpeed = 10
let myEnemyHp = 0
let myClock

let moveAmount = 10
let x = 50
let y = 800
let velX = 0
let velY = 0

const ACCEL = 1.2     
const MAX_SPEED = 5 
const FRICTION = 0.85 
let keys = {}

document.addEventListener("keydown", e => keys[e.key] = true)
document.addEventListener("keyup", e => keys[e.key] = false)


 let isAttacking = false
  let attackDuration = 200
  let myDirection = "right"

let myImg01
let myImg02
let myPortal

window.onload = function () {

		myImg01 = document.getElementById("myImg01")
		myImg02 = document.getElementById("myImg02")
		myPortal = document.getElementById("rift")

  document.addEventListener("keydown", function (e) {

  keys[e.key] = true

  if (e.key === " ") attack()

  if (!musicStarted) {
    bossMusic.volume = 0.6
    bossMusic.play()
    musicStarted = true
  }
})
  
document.addEventListener("keyup", function (e) {
  keys[e.key] = false
})
  
setInterval(updatePlayer, 20)

function updatePlayer() {
  let oldX = x
  let oldY = y

  if (keys["w"]) velY -= ACCEL
  if (keys["s"]) velY += ACCEL
  if (keys["a"]) { velX -= ACCEL; myDirection = "left" }
  if (keys["d"]) { velX += ACCEL; myDirection = "right" }

  velX = Math.max(-MAX_SPEED, Math.min(MAX_SPEED, velX))
  velY = Math.max(-MAX_SPEED, Math.min(MAX_SPEED, velY))

  x += velX
  y += velY

  if (!keys["a"] && !keys["d"]) velX *= FRICTION
  if (!keys["w"] && !keys["s"]) velY *= FRICTION

  myImg01.style.left = x + "px"
  myImg01.style.top = y + "px"

  if (myHitOther('myImg01', 'myImg02')) {
    x = oldX
    y = oldY
    velX = 0
    velY = 0
  }
}

	teleport()
    }
	  myClock = setInterval(myEnemy, 600)


// Collision
function myHitOther(my1,my2){
    let a = document.getElementById(my1)
    let b = document.getElementById(my2)

    let left1 = parseInt(a.style.left)
    let right1 = left1 + parseInt(a.style.width)
    let top1 = parseInt(a.style.top)
    let bottom1 = top1 + parseInt(a.style.height)

    let left2 = parseInt(b.style.left)
    let right2 = left2 + parseInt(b.style.width)
    let top2 = parseInt(b.style.top)
    let bottom2 = top2 + parseInt(b.style.height)

    return right1 >= left2 && left1 <= right2 &&
           bottom1 >= top2 && top1 <= bottom2
}


// Enemy AI
function myEnemy() {
    let direction = Math.random() < 0.5 ? -1 : 1
    enemyX += direction * enemySpeed

    if (enemyX < 0) enemyX = 0
    if (enemyX > window.innerWidth - 100)
        enemyX = window.innerWidth - 100
		
    document.getElementById('myImg02').style.left = enemyX + "px"
}

// Attacking
function attack() {
  if (isAttacking) return
  isAttacking = true

  attackBox.style.display = "block"

  if (myDirection === "right") {
    attackBox.style.left = (x + 75) + "px"
    attackBox.style.top = (y - 20) + "px"
  } else {
    attackBox.style.left = (x - 60) + "px"
    attackBox.style.top = (y - 20) + "px"
  }

  if (myHitOther('attackBox', 'myImg02')) enemyHit()

  setTimeout(() => {
    attackBox.style.display = "none"
    isAttacking = false
  }, attackDuration)
}


// When Enemy is hit
function enemyHit() {
	if (myEnemyHp >= 11) {
	document.getElementById('myImg02').style.display = "none"
	} else {
	console.log ("enemy defeated!")
	myEnemyHp ++
	}
	}
	
// To go to the next stage
function teleport() {
    if (myHitOther('myImg01', 'rift')) {
        myImg01.style.left = '0px'
        myImg01.style.top  = '0px'
        console.log("rift entered")
        location = "loadingscreen.html"
    }
}

</script>

</body>
